<!DOCTYPE html>
<html>
<head>
    <title>Google Maps Route Display</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAvT2xObdu5cvGrAxUcJz3cIHcYq0sPdvU"></script>
    <style>
        /* 设置地图和 body 的样式 */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100vh; /* 使地图高度为视口高度的 100% */
            width: 100vw;  /* 使地图宽度为视口宽度的 100% */
        }
        /* 设置按钮样式 */
        #navButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            z-index: 1000; /* 确保按钮在页面上层 */
        }
        #navButton:hover {
            background-color: #0056b3;
        }
    </style>
    <script>
        async function initMap() {
            // 创建地图
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: { lat: 33.5904, lng: 130.4017 } // Fukuoka center
            });

            // Directions Renderer 用于展示路线
            var directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);

            // 请求优化后的路线
            const routeURL = 'https://routes.googleapis.com/directions/json';
            const response = await fetch(`${routeURL}?origin=2+Chome-17-20+Befu,+Shime,+Kasuya+District,+Fukuoka+811-2205&destination=2+Chome-17-20+Befu,+Shime,+Kasuya+District,+Fukuoka+811-2205&waypoints=福岡市博多区+上牟田3-8-3|福岡市博多区+竹下1-15-40|福岡市中央区+舞鶴1-5-9|福岡市博多区+東平尾1-5-13|糟屋郡志免町+南里2-20-13&key=AIzaSyAvT2xObdu5cvGrAxUcJz3cIHcYq0sPdvU`);

            const data = await response.json();
            if (data.routes && data.routes.length > 0) {
                // 获取第一个路由的详细信息
                const route = data.routes[0];
                const waypoints = route.legs.flatMap(leg => leg.via_waypoints.map(point => `${point.location.lat()},${point.location.lng()}`));

                // 生成 Google Maps 导航链接
                let navURL = 'https://www.google.com/maps/dir/?api=1';
                navURL += '&origin=' + encodeURIComponent('2 Chome-17-20 Befu, Shime, Kasuya District, Fukuoka 811-2205');
                navURL += '&destination=' + encodeURIComponent('2 Chome-17-20 Befu, Shime, Kasuya District, Fukuoka 811-2205');
                if (waypoints.length > 0) {
                    navURL += '&waypoints=' + encodeURIComponent(waypoints.join('|'));
                }

                // 更新按钮链接
                document.getElementById('navButton').href = navURL;

                // 将路线展示在地图上
                const directionsService = new google.maps.DirectionsService();
                directionsService.route({
                    origin: '2 Chome-17-20 Befu, Shime, Kasuya District, Fukuoka 811-2205',
                    destination: '2 Chome-17-20 Befu, Shime, Kasuya District, Fukuoka 811-2205',
                    waypoints: waypoints.map(point => ({ location: point, stopover: true })),
                    travelMode: 'DRIVING',
                    optimizeWaypoints: true
                }, (response, status) => {
                    if (status === 'OK') {
                        directionsRenderer.setDirections(response);
                    } else {
                        console.error('Directions request failed due to ' + status);
                    }
                });
            } else {
                console.error('No routes found');
            }
        }
    </script>
</head>
<body onload="initMap()">
    <div id="map"></div>
    <a id="navButton" href="#" target="_blank">点击这里在 Google Maps 中导航</a>
</body>
</html>
